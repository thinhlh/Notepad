[{"path":"","header":"Document 1","text":"","language":"None"},{"path":"","header":"Document 2*","text":"using System;\nusing System.Collections.Generic;\nusing System.Configuration;\nusing System.IO;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows;\nusing System.Windows.Controls;\nusing Microsoft.Win32;\nusing Notepad;\nusing Notepad.Snippets;\n\nnamespace Notepad.Classes\n{\n    /// <summary>\n    /// Use for Extension Methods of MainWindow\n    /// </summary>\n    public static class MainWindowExtension\n    {\n        /// <summary>\n        /// Params to access fields easiers\n        /// </summary>\n        private static MainWindow mainWindow = Application.Current.MainWindow as MainWindow;\n        private static TabControl tabControl = (Application.Current.MainWindow as MainWindow).tabControl;\n        private static List<MainTabItem> tabItems = (Application.Current.MainWindow as MainWindow).tabItems;\n        private static List<int> closedTabIndexes = (Application.Current.MainWindow as MainWindow).closedTabIndexes;\n        private static System.Collections.Specialized.NameValueCollection appSetting = ConfigurationManager.AppSettings;\n\n        public static void InitializeTabItem()\n        {\n            MainTabItem tabItem = new MainTabItem();\n            //\n            //Add tabItem to tabControl\n            //\n            tabControl.Items.Add(tabItem);\n            tabItems.Add(tabItem);\n            tabItem.Focus(); // selected index will focus on the new tab\n\n\n\n            //Setup for tabItem\n            int tabIndex = FindIndexForTab();\n            tabItem.Header = \"Document \" + (tabIndex + 1); // Header Display Always larger than 1 of the number of element in tabItems\n            tabItem.Name = \"TabItem\" + (tabIndex);\n\n            //Set Content for TabItem\n        }\n\n        public static int FindIndexForTab() // this function define which tabIndex is approriate for InitTab \n        {\n            if (closedTabIndexes.Count == 0)\n                return tabControl.Items.Count - 1;\n            else\n            {\n                int index = closedTabIndexes[0];\n                closedTabIndexes.RemoveAt(0);\n                return index;\n            }\n        }\n\n        public static void UpdateStatusBar(int index)\n        {\n            if (index == -1)\n                mainWindow.StatusText.DataContext = \"None\";// No update when close all tab\n            else if (tabItems[index].FilePath == \"\")\n                mainWindow.StatusText.DataContext = \"Plain Text\";\n            else\n                mainWindow.StatusText.DataContext = tabItems[tabControl.SelectedIndex].FilePath;\n        }\n        public static void RaiseUnsavedIcon()\n        {\n            List<MainTabItem> tabItems = mainWindow.tabItems;\n            TabControl tabControl = mainWindow.tabControl;\n\n            if (tabControl.SelectedIndex < 0) return;\n            if (tabItems[tabControl.SelectedIndex].IsSaved == false)\n            {\n                return;\n            }\n            else\n            {\n                //Raise* at the end and keep isSaved = false when there is a change with out save before\n                tabItems[tabControl.SelectedIndex].Header += \"*\";\n                tabItems[tabControl.SelectedIndex].IsSaved = false;  \n            }\n            //Resubscribe when this tab is Saved\n        }\n\n        private static void RemoveSavedIcon(int index)\n        {\n            tabItems[index].IsSaved = true;\n\n            string header = tabItems[index].Header.ToString();\n            tabItems[index].Header = header.Remove(header.Length - 1, 1);\n        }\n        public static string GetParentFullPath(int index)\n        {\n            return Path.Combine(tabItems[index].FilePath, \"..\");\n        }\n\n        public static DirectoryInfo TryGetSolutionDirectoryInfo(string currentPath = null)\n        {\n            var directory = new DirectoryInfo(\n                currentPath ?? Directory.GetCurrentDirectory());\n            while (directory != null && !directory.GetFiles(\"*.sln\").Any())\n            {\n                directory = directory.Parent;\n            }\n            return directory;\n        }\n\n        public static List<TemporaryDetail> DeserializeTemporaryDetail()\n        {\n            string JsonPath = TryGetSolutionDirectoryInfo().FullName + @\"\\Notepad\\temp\\TabDetails.json\";\n\n            if (!File.Exists(JsonPath)) return null;\n            string output = File.ReadAllText(JsonPath);\n            var details = Newtonsoft.Json.JsonConvert.DeserializeObject<List<TemporaryDetail>>(output);\n            return details;\n        }\n\n        public static void SaveExecuted(int index)\n        {\n            if (!tabItems[index].IsSaved || string.IsNullOrWhiteSpace(tabItems[index].Data)) // not yet saved or new tab but not have data\n            {\n                SaveFileDialog saveFileDialog = new SaveFileDialog();\n\n                bool fileExsisted = System.IO.File.Exists(tabItems[index].FilePath);\n                if (fileExsisted)\n                {\n                    System.IO.File.WriteAllText(tabItems[index].FilePath, tabItems[index].Data);\n                    RemoveSavedIcon(index);\n                }\n                else SaveAsExecuted(index);\n            }\n            //subscribe to listen when text changed again\n        }\n        public static void SaveAsExecuted(int index)\n        {\n            SaveFileDialog saveFileDialog = new SaveFileDialog();\n\n            saveFileDialog.InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);\n            saveFileDialog.DefaultExt = \".txt\";\n            saveFileDialog.Filter = \"Text (*.txt)|*.txt| Java (*.java) |*.java| C (*.c) |*.c| C++ (*.cpp) |*.cpp| C# (*.cs) |*.cs| All files (*.*) |*.* \";\n            string tabHeader = (string)tabItems[tabControl.SelectedIndex].Header;\n            saveFileDialog.FileName = tabHeader.Substring(0, tabHeader.Length - 1); // remove the * flag\n            if (saveFileDialog.ShowDialog() == true)\n            {\n                System.IO.File.WriteAllText(saveFileDialog.FileName, tabItems[index].Data);\n                RemoveSavedIcon(index);\n                tabItems[index].Header = Path.GetFileName(saveFileDialog.FileName);\n                tabItems[index].FilePath = saveFileDialog.FileName;\n\n                //Update Status Bar\n                UpdateStatusBar(index);\n            }\n            \n            mainWindow.treeView.Items.Refresh();\n            mainWindow.treeView.UpdateLayout();\n        }\n        public static void CloseFileExecuted(int index)\n        {\n            if (tabItems[index].IsSaved == false)\n            {\n                //Message then request save\n                string tabHeader = (string)tabItems[index].Header;\n                string message = tabHeader.Substring(0, tabHeader.Length - 1) + \" have been modified, save changes?\";\n\n                MessageBoxResult result = MessageBox.Show(message, \"Request\", MessageBoxButton.YesNoCancel, MessageBoxImage.Question);\n                if (result == MessageBoxResult.Yes)\n                    MainWindowExtension.SaveAsExecuted(index);\n                else if (result == MessageBoxResult.Cancel)\n                    return;\n            }\n            tabControl.Items.RemoveAt(index);\n            int deletedIndexTab = Int16.Parse(tabItems[index].Name.Substring(7)); // Return the index of deleted tabItem by get subTring from name then convert to int\n\n            tabItems.RemoveAt(index);\n\n            //Add Index of tab then sort it for reopen new tab situation \n            closedTabIndexes.Add(deletedIndexTab);\n            closedTabIndexes.Sort();\n        }\n\n\n        public static void OpenFileInNewTab(Languages language,string path)\n        {\n            MainWindowExtension.InitializeTabItem();\n\n            int indexForTab;\n            /* \n             * Determining which tab the file will be open\n             * If open in new tab => tabItems.Count-1\n             * if open in recent tab => tabControl.selected\n            */\n            if (tabItems[tabControl.SelectedIndex].FilePath != \"\" || !string.IsNullOrWhiteSpace(tabItems[tabControl.SelectedIndex].Data))\n            {\n                MainWindowExtension.InitializeTabItem();\n                indexForTab = tabItems.Count - 1;\n            }\n            else\n                indexForTab = tabControl.SelectedIndex;\n\n            tabItems[indexForTab].Data = System.IO.File.ReadAllText(path); //Read File here\n\n            //Unsubscribe TextChange event\n            tabItems[indexForTab].RichTextBox.richTextBox.TextChanged -= tabItems[indexForTab].RichTextBox.richTextBox_Highlight;\n\n            // Add content to richTextBox\n            tabItems[indexForTab].Data = tabItems[indexForTab].Data;// Set Data For RTB\n\n            //set language => auto Highlight all\n            tabItems[indexForTab].RichTextBox.Language =language;\n\n            //Resubscribe\n            tabItems[indexForTab].RichTextBox.richTextBox.TextChanged += tabItems[indexForTab].RichTextBox.richTextBox_Highlight;\n\n            //Scroll to the end of the text\n            tabItems[indexForTab].RichTextBox.richTextBox.SelectionStart = tabItems[indexForTab].RichTextBox.richTextBox.Text.Length;\n\n            tabItems[indexForTab].Header = Path.GetFileName(path);\n            tabItems[indexForTab].FilePath = path;\n            tabItems[indexForTab].IsSaved = true;\n\n            //Update Status Bar\n            MainWindowExtension.UpdateStatusBar(indexForTab);\n        }\n        /// <summary>\n        /// Get Languages From The extension\n        /// </summary>\n        /// <param name=\"pathHasExtension\"> Path to the file that contains Extension</param>\n        public static Languages GetLanguageFromExtension(string pathHasExtension)\n        {\n            switch (Path.GetExtension(pathHasExtension))\n            {\n                case \".cs\":\n                    return Languages.CSharph;\n                case \".cpp\":\n                    return Languages.CPlusPlus;\n                case \".c\":\n                    return Languages.C;\n                case \".java\":\n                    return Languages.Java;\n                default:\n                    return Languages.None;\n            }\n        }\n        public static void ReadFile(string path)\n        {\n\n        }\n\n        public static void MovePinnedTab(MainTabItem tabItem)\n        {\n            tabControl.Items.Remove(tabItem);\n            tabItems.Remove(tabItem);\n            tabControl.Items.Insert(0, tabItem);\n            tabItems.Insert(0, tabItem);\n            tabItem.IsSelected = true;\n        }\n\n    }\n}","language":"CSharph"}]
